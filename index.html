<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NYC Ultimate Planner</title>
    <style>
        :root { --primary: #2c3e50; --accent: #e74c3c; --bg: #f4f7f6; --link: #3498db; --near: #9b59b6; --pier: #16a085; --food: #e67e22; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 110px; color: var(--primary); }
        .header { text-align: center; background: #fff; padding: 15px; border-radius: 20px; margin-bottom: 15px; border: 2px solid #eee; }
        .day-card { background: white; border-radius: 20px; padding: 15px; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-right: 8px solid var(--link); }
        .day-title { font-weight: 800; font-size: 1.1em; color: var(--accent); margin-bottom: 10px; display: block; }
        .editable { border-bottom: 1px dashed #ccc; padding: 2px; min-width: 20px; display: inline-block; cursor: text; }
        .label { font-weight: bold; font-size: 0.8em; color: #95a5a6; display: block; margin-top: 10px; }
        .content { font-size: 1em; color: #34495e; line-height: 1.6; }
        
        /* Checklist Style */
        .checklist { margin-top: 15px; background: #f9f9f9; padding: 10px; border-radius: 12px; }
        .todo-item { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; font-size: 0.9em; }
        .todo-item input[type="checkbox"] { width: 18px; height: 18px; }
        .add-todo { background: none; border: 1px solid #ddd; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; margin-top: 5px; }

        /* Bottom Nav */
        .survival-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; border-top: 1px solid #eee; }
        .tool-btn { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #34495e; font-size: 0.65em; font-weight: bold; gap: 4px; border: none; background: none; }
        .tool-icon { font-size: 1.5em; }
        
        #file-section { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2000; padding: 20px; box-sizing: border-box; overflow-y: auto; }
    </style>
</head>
<body>

<div id="main-view">
    <div class="header">
        <h1 style="margin:0;">ğŸ—½ NYC TRIP MASTER</h1>
        <p style="margin:5px 0 0; font-size:0.8em;">× ×™×ª×Ÿ ×œ×¢×¨×•×š ×›×œ ×˜×§×¡×˜ - ×”×›×œ × ×©××¨ ××•×˜×•××˜×™×ª!</p>
    </div>
    <div id="app"></div>
</div>

<div id="file-section">
    <button onclick="toggleFiles()" style="background:var(--accent); color:white; border:none; padding:10px; border-radius:10px;">â¬…ï¸ ×—×–×¨×”</button>
    <h2>ğŸ“ ××¡××›×™× ×•×§×‘×¦×™×</h2>
    <input type="file" id="fileInput" multiple><br><br>
    <div id="fileList"></div>
</div>

<div class="survival-bar">
    <a href="https://citymapper.com/nyc" target="_blank" class="tool-btn"><span class="tool-icon">ğŸš‡</span><span>×¡××‘×•×•×™×™</span></a>
    <button onclick="toggleFiles()" class="tool-btn"><span class="tool-icon">ğŸ“</span><span>×§×‘×¦×™×</span></button>
    <button onclick="saveAll()" class="tool-btn"><span class="tool-icon">ğŸ’¾</span><span>×©××•×¨ ×”×›×œ</span></button>
    <a href="https://www.google.com/maps/search/${encodeURIComponent('Marshalls')}" target="_blank" class="tool-btn"><span class="tool-icon">ğŸ›ï¸</span><span>×©×•×¤×™× ×’</span></a>
</div>

<script>
    // × ×ª×•× ×™× ×¨××©×•× ×™×™×
    const defaultData = [
        { day: 1, date: "27-Sep", area: "Flatiron", sights: "Times Square, Grand Central", food: "Eataly", rooftop: "230 Fifth", todos: [] },
        { day: 4, date: "30-Sep", area: "SoHo + Nolita + LES", sights: "Little Italy, Chinatown, Elizabeth St Garden", food: "Katzâ€™s Deli, Russ & Daughters", rooftop: "PHD SoHo", todos: [] },
        { day: 8, date: "04-Oct", area: "Washington DC", sights: "National Mall, Lincoln Memorial, Capitol", food: "Tompkins Bagels", rooftop: "-", todos: [] },
        { day: 10, date: "06-Oct", area: "Downtown", sights: "Wall Street, 9/11 Memorial, ×¤×¡×œ ×”×—×™×¨×•×ª", food: "Manhatta", rooftop: "Overstory", todos: [] },
        { day: 12, date: "08-Oct", area: "Midtown - ×˜×™×¡×”", sights: "5th Ave, Broadway, Bryant Park", food: "Ess-a-Bagel", rooftop: "Refinery", todos: [] }
    ];

    // ×˜×¢×™× ×” ××”×–×™×›×¨×•×Ÿ ××• ××”×‘×¨×™×¨×ª ××—×“×œ
    let tripData = JSON.parse(localStorage.getItem('nyc_trip_data')) || defaultData;

    function renderApp() {
        const app = document.getElementById('app');
        app.innerHTML = '';
        tripData.forEach((day, index) => {
            const card = document.createElement('div');
            card.className = 'day-card';
            card.innerHTML = `
                <span class="day-title">${day.date} | <span class="editable" oninput="updateData(${index}, 'area', this.innerText)" contenteditable="true">${day.area}</span></span>
                
                <span class="label">ğŸ¢ ××ª×¨×™×:</span>
                <div class="editable content" oninput="updateData(${index}, 'sights', this.innerText)" contenteditable="true">${day.sights}</div>
                
                <span class="label" style="color:var(--food)">ğŸ´ ××•×›×œ:</span>
                <div class="editable content" oninput="updateData(${index}, 'food', this.innerText)" contenteditable="true">${day.food}</div>
                
                <span class="label" style="color:var(--rooftop)">ğŸ¸ ×¨×•×¤×˜×•×¤:</span>
                <div class="editable content" oninput="updateData(${index}, 'rooftop', this.innerText)" contenteditable="true">${day.rooftop}</div>

                <div class="checklist">
                    <span class="label">âœ… ×¨×©×™××ª ×¦'×§-×œ×™×¡×˜:</span>
                    <div id="todo-${index}">
                        ${(day.todos || []).map((todo, tIdx) => `
                            <div class="todo-item">
                                <input type="checkbox" ${todo.done ? 'checked' : ''} onclick="toggleTodo(${index}, ${tIdx})">
                                <span class="editable" contenteditable="true" oninput="updateTodo(${index}, ${tIdx}, this.innerText)">${todo.text}</span>
                            </div>
                        `).join('')}
                    </div>
                    <button class="add-todo" onclick="addTodo(${index})">+</button>
                </div>
            `;
            app.appendChild(card);
        });
    }

    function updateData(index, field, value) {
        tripData[index][field] = value;
        localStorage.setItem('nyc_trip_data', JSON.stringify(tripData));
    }

    function addTodo(dayIdx) {
        if (!tripData[dayIdx].todos) tripData[dayIdx].todos = [];
        tripData[dayIdx].todos.push({ text: "××©×™××” ×—×“×©×”", done: false });
        localStorage.setItem('nyc_trip_data', JSON.stringify(tripData));
        renderApp();
    }

    function toggleTodo(dayIdx, tIdx) {
        tripData[dayIdx].todos[tIdx].done = !tripData[dayIdx].todos[tIdx].done;
        localStorage.setItem('nyc_trip_data', JSON.stringify(tripData));
    }

    function updateTodo(dayIdx, tIdx, val) {
        tripData[dayIdx].todos[tIdx].text = val;
        localStorage.setItem('nyc_trip_data', JSON.stringify(tripData));
    }

    function saveAll() {
        localStorage.setItem('nyc_trip_data', JSON.stringify(tripData));
        alert("×”×›×œ × ×©××¨ ×‘×”×¦×œ×—×” ×‘×˜×œ×¤×•×Ÿ!");
    }

    function toggleFiles() {
        const fs = document.getElementById('file-section');
        fs.style.display = fs.style.display === 'block' ? 'none' : 'block';
    }

    // × ×™×”×•×œ ×§×‘×¦×™×
    const fileInput = document.getElementById('fileInput');
    fileInput.addEventListener('change', (e) => {
        const files = Array.from(e.target.files);
        let savedFiles = JSON.parse(localStorage.getItem('nyc_files') || '[]');
        files.forEach(file => {
            const reader = new FileReader();
            reader.onload = (ev) => {
                savedFiles.push({ name: file.name, data: ev.target.result });
                localStorage.setItem('nyc_files', JSON.stringify(savedFiles));
                renderFiles();
            };
            reader.readAsDataURL(file);
        });
    });

    function renderFiles() {
        const files = JSON.parse(localStorage.getItem('nyc_files') || '[]');
        document.getElementById('fileList').innerHTML = files.map((f, i) => `
            <div style="margin:10px; padding:10px; border:1px solid #ddd; border-radius:10px; display:flex; justify-content:space-between;">
                <span>${f.name}</span>
                <a href="${f.data}" download="${f.name}">ğŸ’¾</a>
            </div>
        `).join('');
    }

    renderApp();
    renderFiles();
</script>
</body>
</html>
